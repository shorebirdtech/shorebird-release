name: Shorebird Release
description: Create a new release using the Shorebird CLI

branding:
  icon: package
  color: green

inputs:
  flutter-version:
    description: The Flutter version to use alongside Shorebird
    required: false
  platform:
    description: The platform for which to create a release (e.g. android, ios-alpha)
    required: true
  working-directory:
    description: The working directory in which to run Shorebird
    required: false
    default: .

outputs:
  release-version:
    description: The version of the release that was created.
    value: ${{ steps.shorebird-release.outputs.release-version }}

runs:
  using: composite
  steps:
    - uses: shorebirdtech/setup-shorebird@v0
      id: shorebird-release
      with:
        flutter-version: ${{ inputs.flutter-version }}
      run: |
        OUTPUT=$(shorebird release ${{ inputs.platform }})
        REGEXP="Published Release (.*)!"
        if [[ $OUTPUT =~ $REGEXP ]]; then
            RELEASE_VERSION=${BASH_REMATCH[1]}
            echo "release-version=$(echo $RELEASE_VERSION)" >> $GITHUB_OUTPUT
        else
            echo "Failed to create release"
            exit 1    
        fi
      working-directory: ${{ inputs.working-directory }}
